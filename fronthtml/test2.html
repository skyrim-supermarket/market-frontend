<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Login</title>
        <link rel="stylesheet" href="css/style2.css">
        <link rel="icon" href="assets/logoBlack.svg">

        
    </head>
    <body>
        <div class="container-index">
                
            <div class="sidebar">
                <div>
                    <img class="logo" src="assets/gold.png"/>
                </div>
                <div class="productClasses">
                    <ul id="classes-ul">
                    </ul>
                </div>
            </div>

            

            <div id="vertDiv">
                <svg id="svg" xmlns="http://www.w3.org/2000/svg">
                </svg>
            </div>

            <div class="container2">
                <div class="navbar">
                        <input type="text" />
                </div>

                <div class="filters">
                        Donec faucibus dolor mi, id vestibulum arcu ornare et. Ut sit amet ipsum purus. Nulla ut condimentum nisl. 
                        Nunc dictum diam id ultrices faucibus. Maecenas eget auctor arcu. Pellentesque dapibus enim vel turpis tristique, 
                        sed aliquam nulla pharetra. Donec faucibus arcu ipsum, ut auctor sem hendrerit id.
                </div>

                <div class="product-list">
                    <div class="product-item selected">
                        <div class="product-item-image">
                            <img src="assets/bone-arrow.png"/>
                        </div>
                        <div class="product-item-name">
                            <span class="product-item-name-text">Shadowed Tower Netch Leather Shield</span>
                        </div>
                        <div class="product-item-price">
                            <div class="product-item-price-gold"><img src="assets/gold.png"/></div>
                            <div class="product-item-price-value"><span>300</span></div>
                        </div>
                    </div>    
                    <div class="product-item">
                        <div class="product-item-image">
                            <img src="assets/bone-arrow.png"/>
                        </div>
                        <div class="product-item-name">
                            <span class="product-item-name-text">Bone Arrow</span>
                        </div>
                        <div class="product-item-price">
                            <div class="product-item-price-gold"><img src="assets/gold.png"/></div>
                            <div class="product-item-price-value"><span>300</span></div>
                        </div>
                    </div> 
                    <div class="product-item">
                        <div class="product-item-image">
                            <img src="assets/bone-arrow.png"/>
                        </div>
                        <div class="product-item-name">
                            <span class="product-item-name-text">Bone Arrow</span>
                        </div>
                        <div class="product-item-price">
                            <div class="product-item-price-gold"><img src="assets/gold.png"/></div>
                            <div class="product-item-price-value"><span>300</span></div>
                        </div>
                    </div>               
                </div>

                <div id="vertDiv2">
                    <svg id="svg2" xmlns="http://www.w3.org/2000/svg"></svg>
                </div>

                <div class="product-info">
                        Interdum et malesuada fames ac ante ipsum primis in faucibus. 
                </div>
            </div>

            <div class="rodape"></div>
        </div>
        

    <script>
        const bg = Math.floor(Math.random() * 6);

        let i = 0;

        document.body.style.backgroundImage = `url('assets/bg/${bg}.png')`;

        const types = ["AMMUNITION", "ARMOR", "BOOKS", "CLOTHING", "FOOD", "INGREDIENTS", "MISCELLANEOUS", "ORES", "POTIONS", "SOUL GEMS", "WEAPONS"];

        const ySeta = 200;

        function straightLine() {
            const svg = document.getElementById("svg");
            const container = document.getElementById("vertDiv");
            const rect = container.getBoundingClientRect();
            const width = rect.width;
            const height = rect.height;

            svg.setAttribute('width', `${width}`);
            svg.setAttribute('height', `${height}`);

            while (svg.firstChild) {
                svg.removeChild(svg.firstChild);
            }

            ////////////// gradiente 1ª linha
            const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
            const gradientTop = document.createElementNS("http://www.w3.org/2000/svg", "linearGradient");
            gradientTop.setAttribute("id", "gradTop");
            gradientTop.setAttribute("x1", "0%");
            gradientTop.setAttribute("y1", "0%");
            gradientTop.setAttribute("x2", "0%");
            gradientTop.setAttribute("y2", "100%");

            const stopA1 = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stopA1.setAttribute("offset", "0%");
            stopA1.setAttribute("stop-color", "white");
            stopA1.setAttribute("stop-opacity", "0");

            const stopA2 = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stopA2.setAttribute("offset", "25%");
            stopA2.setAttribute("stop-color", "white");
            stopA2.setAttribute("stop-opacity", "1");

            const stopA3 = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stopA3.setAttribute("offset", "100%");
            stopA3.setAttribute("stop-color", "white");
            stopA3.setAttribute("stop-opacity", "1");

            gradientTop.appendChild(stopA1);
            gradientTop.appendChild(stopA2);
            gradientTop.appendChild(stopA3);

            ////////////// gradiente 4ª linha
            const gradientBottom = document.createElementNS("http://www.w3.org/2000/svg", "linearGradient");
            gradientBottom.setAttribute("id", "gradBottom");
            gradientBottom.setAttribute("x1", "0%");
            gradientBottom.setAttribute("y1", "0%");
            gradientBottom.setAttribute("x2", "0%");
            gradientBottom.setAttribute("y2", "100%");

            const stopB1 = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stopB1.setAttribute("offset", "0%");
            stopB1.setAttribute("stop-color", "white");
            stopB1.setAttribute("stop-opacity", "1");

            const stopB2 = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stopB2.setAttribute("offset", "75%");
            stopB2.setAttribute("stop-color", "white");
            stopB2.setAttribute("stop-opacity", "1");

            const stopB3 = document.createElementNS("http://www.w3.org/2000/svg", "stop");
            stopB3.setAttribute("offset", "100%");
            stopB3.setAttribute("stop-color", "white");
            stopB3.setAttribute("stop-opacity", "0");

            gradientBottom.appendChild(stopB1);
            gradientBottom.appendChild(stopB2);
            gradientBottom.appendChild(stopB3);

            defs.appendChild(gradientTop);
            defs.appendChild(gradientBottom);
            svg.appendChild(defs);

            // Coordenadas
            const x0 = width/2;
            const y0 = 0;
            const y1 = height*0.585-14;
            const y2 = height*0.585;
            const y3 = height*0.585+14;
            const y4 = height;

            // 1ª linha
            const line1 = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            line1.setAttribute("x", x0-0.55);
            line1.setAttribute("y", y0);
            line1.setAttribute("width", 1.1);
            line1.setAttribute("height", y1);
            line1.setAttribute("fill", "url(#gradTop)");
            line1.setAttribute('id', 'line1');
            svg.appendChild(line1);

            // 2ª linha
            const line2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line2.setAttribute('x1', `${x0}`);
            line2.setAttribute('x2', `${x0}`);
            line2.setAttribute('y1', `${y1}`);
            line2.setAttribute('y2', `${y2}`);
            line2.setAttribute('stroke', "white");
            line2.setAttribute('stroke-width', 1.1);
            line2.setAttribute('id', 'line2');
            svg.appendChild(line2);

            // 3ª linha
            const line3 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line3.setAttribute('x1', `${x0}`);
            line3.setAttribute('x2', `${x0}`);
            line3.setAttribute('y1', `${y2}`);
            line3.setAttribute('y2', `${y3}`);
            line3.setAttribute('stroke', "white");
            line3.setAttribute('stroke-width', 1.1);
            line3.setAttribute('id', 'line3');
            svg.appendChild(line3);

            // 4ª linha
            const line4 = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            line4.setAttribute("x", x0-0.55);
            line4.setAttribute("y", y3);
            line4.setAttribute("width", 1.1);
            line4.setAttribute("height", y4-y3);
            line4.setAttribute("fill", "url(#gradBottom)");
            line4.setAttribute('id', 'line4');
            svg.appendChild(line4);
        }

        function appendComplexSeta() {
            const svg = document.getElementById("svg");
            const container = document.getElementById("vertDiv");
            const rect = container.getBoundingClientRect();
            const width = rect.width;
            const height = rect.height;

            const x0 = width/2;
            const y1 = height*0.585-13;
            const y3 = height*0.585+13;

            const line2 = document.getElementById('line2');
            const line3 = document.getElementById('line3');

            line2.setAttribute('x2', `${x0+15}`);
            line3.setAttribute('x1', `${x0+15}`);

            const img = document.createElementNS('http://www.w3.org/2000/svg', 'image');
            img.setAttributeNS(null, 'href', 'assets/seta2.svg'); 
            img.setAttributeNS(null, 'id', 'complex_seta'); 
            img.setAttributeNS(null, 'x', `${x0-18}`);
            img.setAttributeNS(null, 'y', `${y1}`);
            img.setAttributeNS(null, 'width', 33);
            img.setAttributeNS(null, 'height', `${y3 - y1}`);
            svg.appendChild(img);
        }

        function removeComplexSeta() {
            const seta = document.getElementById('complex_seta');
            const line2 = document.getElementById('line2');
            const line3 = document.getElementById('line3');
            line2.setAttribute('x2', `${parseFloat(line2.getAttribute('x2'))-15}`);
            line3.setAttribute('x1', `${parseFloat(line3.getAttribute('x1'))-15}`);
            seta.remove();
        }

        function fillUL(types, i) {
            const ul = document.getElementById("classes-ul");

            while (ul.firstChild) {
                ul.removeChild(ul.firstChild);
            }

            const height = window.innerHeight;

            let qtd;

            if(height>=980) 
                qtd = 9;
            else if(height>=760)
                qtd = 7;
            else if(height>=640)
                qtd = 5;
            else
                qtd = 3;


            


            let lim = Math.floor(qtd/2);
            for(var j=i-lim; j<=i+lim; j+=1) {
                let li = document.createElement('li');

                if(j==i-4 || j==i+4) {li.setAttribute('class', `sideBarItem edge3`);}
                else if(j==i-3 || j==i+3) {li.setAttribute('class', `sideBarItem edge2`);}
                else if(j==i-2 || j==i+2) {li.setAttribute('class', `sideBarItem edge1`);}
                else if(j==i-1 || j==i+1) {li.setAttribute('class', `sideBarItem center`);}
                else {li.setAttribute('class', `sideBarItem centerSelected`);}


                let a = document.createElement('a');


                let id = j%types.length;
                if(id<0) id+=types.length;

                a.textContent = types[id];
                a.href = "#";

                li.appendChild(a);
                ul.appendChild(li);
            }
        }
        
        function setViewportSize(id, idsvg) {
            const svg = document.getElementById(idsvg);
            const container = document.getElementById(id);
            const rect = container.getBoundingClientRect();
            const left = rect.left;
            const top = rect.top;
            const width = rect.width;
            const height = rect.height;


            //console.log(`${left} ${top} ${width} ${height}`);
            
            //svg.setAttribute('viewBox', `${left} ${top} ${width} ${height}`);
            svg.setAttribute('width', `${width}`);
            svg.setAttribute('height', `${height}`);
            svg.innerHTML = '';

            const lim = Math.floor(height/11.1);

            console.log(`${window.innerHeight} ${height} ${lim}`);


            for(var i=0; i<lim; i++) {
                const svgImage = document.createElementNS('http://www.w3.org/2000/svg', 'image');
                let str = `${idsvg}bar`;
                if(i==0) {
                    svgImage.setAttributeNS(null, 'opacity', `33%`);
                }
                if(i==1) {
                    svgImage.setAttributeNS(null, 'opacity', `66%`);
                }
                if(i==lim-2) {
                    svgImage.setAttributeNS(null, 'opacity', `66%`);
                }
                if(i==lim-1) {
                    svgImage.setAttributeNS(null, 'opacity', `33%`);
                }
                svgImage.setAttributeNS(null, 'id', `${str}${i}`);
                svgImage.setAttributeNS(null, 'href', 'assets/bar.svg');
                svgImage.setAttributeNS(null, 'dominant-baseline', 'middle');
                svgImage.setAttributeNS(null, 'text-anchor', 'middle');
                svgImage.setAttributeNS(null, 'x', "50%");
                svgImage.setAttributeNS(null, 'y', i*11);
                svg.appendChild(svgImage);
            }
        }

        function appendSeta(y, id, idsvg) {
            const svg = document.getElementById(idsvg);
            const container = document.getElementById(id);
            const rect = container.getBoundingClientRect();
            const left = rect.left;
            const top = rect.top;
            const width = rect.width;
            const height = rect.height;

            let intDiv = Math.floor(y/11)-2;
            const resto = y%11;
            if(resto>=6) {
                intDiv++;
            }

            const lim = Math.floor(height/11.1);

            if(intDiv>=2 && intDiv+7<lim) {
                const elem1 = document.getElementById(`${idsvg}bar${intDiv}`);
                const elem2 = document.getElementById(`${idsvg}bar${intDiv+1}`);
                const elem3 = document.getElementById(`${idsvg}bar${intDiv+2}`);
                const elem4 = document.getElementById(`${idsvg}bar${intDiv+3}`);
                const elem5 = document.getElementById(`${idsvg}bar${intDiv+4}`);
                const elem6 = document.getElementById(`${idsvg}bar${intDiv+5}`);

                elem1.remove();
                elem2.remove();
                elem3.remove();
                elem4.remove();
                elem5.remove();
                elem6.remove();

                const svgImage = document.createElementNS('http://www.w3.org/2000/svg', 'image');
                let str = `${idsvg}seta`;

                svgImage.setAttributeNS(null, 'id', `${str}`);
                svgImage.setAttributeNS(null, 'href', 'assets/seta.svg');
                svgImage.setAttributeNS(null, 'dominant-baseline', 'middle');
                svgImage.setAttributeNS(null, 'text-anchor', 'middle');
                svgImage.setAttributeNS(null, 'x', "50%");
                svgImage.setAttributeNS(null, 'y', intDiv*11);
                svg.appendChild(svgImage);
            }
        }

        function removeSeta(idsvg) {
            const seta = document.getElementById(`${idsvg}seta`);
            seta.remove();
            setViewportSize('vertDiv2');
        }

        //window.addEventListener("resize", () => {setViewportSize('vertDiv', 'svg');});
        window.addEventListener("resize", () => {setViewportSize('vertDiv2', 'svg2');});

        //window.addEventListener("resize", () => {appendSeta(ySeta, 'vertDiv', 'svg');});
        window.addEventListener("resize", () => {appendSeta(ySeta, 'vertDiv2', 'svg2');});

        window.addEventListener("resize", straightLine);
        window.addEventListener("resize", appendComplexSeta);

        document.addEventListener('DOMContentLoaded', function(){
            var elements = document.getElementsByClassName('product-item-name');

            for(var element of elements) {
                var pw = element.querySelector('product-item-name-text').offsetWidth;
                var cw = element.offsetWidth;

                if(pw > cw) {
                    element.classList.add('text-overflow');
                }
            }
        });

        window.addEventListener("resize", () => {fillUL(types, i)});
        window.addEventListener("resize", () => {fillUL(types, i)});

        //const svg = document.getElementById("svg");
        //svg.addEventListener("click", () => {appendSeta(ySeta, 'vertDiv', 'svg');});

        const svg2 = document.getElementById("svg2");
        svg2.addEventListener("click", () => {appendSeta(ySeta, 'vertDiv2', 'svg2');});

        const ul = document.getElementById("classes-ul");

        let hover = false;
        let scrollDown = false;
        let scrollUp = false;

        ul.addEventListener("mouseenter", () => {
            console.log("entrou");
            hover = true;
            tryToScrollDown();
            tryToScrollUp();
        });


        ul.addEventListener("mouseleave", () => {
            console.log("saiu");
            hover = false;
        });

        window.addEventListener("wheel", function(event) {
            console.log("scroll");
            if(event.deltaY > 0) {
                console.log("down");
                scrollDown = true;
                tryToScrollDown();
            }
            if(event.deltaY < 0) {
                console.log("up");
                scrollUp = true;
                tryToScrollUp();
            }
        });

        function tryToScrollDown() {
            if(scrollDown && hover) {
                i++;

                fillUL(types, i);

                scrollDown = false;
            }
        }

        function tryToScrollUp() {
            if(scrollUp && hover) {
                i--;

                fillUL(types, i);

                scrollUp = false;
            }
        }
        

        //setViewportSize('vertDiv', 'svg');
        setViewportSize('vertDiv2', 'svg2');
        //appendSeta(ySeta, 'vertDiv', 'svg');
        appendSeta(ySeta, 'vertDiv2', 'svg2');
        straightLine();
        appendComplexSeta();

        fillUL(types, i);
    </script>
    </body>
</html>